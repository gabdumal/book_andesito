---
title: Compilando programas em C
author: Gabriel Malosto
---

import { Aside } from "@astrojs/starlight/components";

import Figure from "/src/components/Figure.astro";
import Keyboard from "/src/components/Keyboard.astro";

import compileHello from "/src/assets/content/docs/c_cpp/compiler/run_c/compile_hello.png";
import compileRunSeparate from "/src/assets/content/docs/c_cpp/compiler/run_c/compile_run_separate.png";
import runHello from "/src/assets/content/docs/c_cpp/compiler/run_c/run_hello.png";
import openingProfiles from "/src/assets/common/opening_profiles.png";
import createProfile from "/src/assets/content/docs/c_cpp/compiler/run_c/create_profile.png";
import selectProfile from "/src/assets/content/docs/c_cpp/compiler/run_c/select_profile.png";

Neste capítulo, vamos aprender a compilar e executar programas com um único arquivo e projetos em C.
Fazermos isso de forma manual e também por meio do Visual Studio Code.

Abra a pasta `dev` que criamos anteriormente para guardar nossos projetos.

```bash
cd ~/dev
```

Dentro dela, crie um diretório chamado `c_cpp_projects` e navegue para dentro dele.

```bash
mkdir c_cpp_projects
cd c_cpp_projects
```

## Programa

Crie um outro diretório chamado `hello_world e também navegue para dentro nele.

```bash
mkdir hello_world
cd hello_world
```

Crie um arquivo chamado `hello_world.c`.

```bash
touch hello_world.c
```

Abra o Visual Studio Code neste diretório.

```bash
code .
```

<Aside type="caution">
  Caso esteja usando o WSl, certifique-se que a extensão [Remote -
  WSL](https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.remote-wsl)
  esteja instalada no Visual Studio Code. Então, garanta que a janela aberta do
  VSCode esteja conectada ao WSL.
</Aside>

Copie o seguinte código para o arquivo `hello_world.c`.
Lembre-se de salvar o arquivo.

```c
#include <stdio.h>

int main() {
    printf("Hello, world!\nThis is my first code in C.\n");
    return 0;
}
```

Vamos utilizar o **Clang** para compilar o código.
O comando de compilação do Clang tem a seguinte estrutura:

```bash
clang [opções] <arquivo>.c -include -o <executavel>
```

- [opções] são as opções de compilação, como:

  - -c para compilar sem ligar os arquivos;
  - -g para incluir informações de debug;
  - -o \<arquivo\> para especificar o arquivo de saída;
  - entre outras.

- \<arquivo\>.c é o nome do arquivo que será compilado.

- \<executavel\> é o nome do arquivo executável de saída.

Assim, com o terminal aberto na pasta `~/dev/c_cpp_projects/hello_world`, execute:

{/* TODO: Verificar como fazer no Windows */}

```bash
clang hello_world.c -o hello_world
```

Se tudo ocorrer bem, um arquivo executável será criado.
Para Linux e WSL, ele se chamará `hello_world`.
Já para o Windows, ele será `hello_world.exe`.

<Figure
  caption={`Compilação do arquivo "hello_world.c".`}
  images={[
    {
      src: compileHello,
      alt: `Terminal exibindo três comandos executados. O primeiro é "ls" e mostra o arquivo "hello_world.c" dentro da pasta "hello_world". O segundo é o de compilação, que não retorna nenhum texto. O terceiro é "ls" novamente, que agora mostra os arquivos "hello_world.c" e "hello_world".`,
    },
  ]}
/>

Para executar o programa, basta chamar o arquivo executável.

```bash
./hello_world
```

<Figure
  caption={`Execução do programa "hello_world".`}
  images={[
    {
      src: runHello,
      alt: `Terminal exibindo o comando "./hello_world" e a saída do programa, que é "Hello, world! This is my first code in C.".`,
    },
  ]}
/>

## Projeto

Retorne para a pasta `c_cpp_projects`.

```bash
cd ~/dev/c_cpp_projects
```

Crie um novo diretório chamado `separate_function` e navegue para dentro dele.

```bash
mkdir separate_function
cd separate_function
```

Crie um arquivo chamado `main.c`.
Então abra o Visual Studio Code no diretório atual.

```bash
touch main.c
code .
```

Copie o seguinte código para o arquivo `main.c`.

```c
#include <stdio.h>

int sum(int a, int b);

int main() {
    int a = 5, b = 7;
    int result = sum(a, b);
    printf("The sum of %d and %d is %d.\n", a, b, result);
    return 0;
}
```

Crie um outro arquivo chamado `functions.c` e cole nele o código a seguir.

```c
int sum(int a, int b) {
    return a + b;
}
```

A função principal `main` chama a função `sum`, que está definida em outro arquivo.
Então, para fazer a compilação, precisamos passar os dois arquivos para o compilador.
Internamente, o compilador fará a compilação de cada arquivo separadamente e, em seguida, fará a ligação entre eles.

Para compilar o projeto, execute o comando abaixo no terminal.
Perceba que você também pode colocar opção -o antes dos arquivos de entrada.
Ela define o nome do arquivo de saída.

```bash
clang main.c functions.c -o separate_function
```

<Figure
  caption={`Compilação do projeto "separate_function".`}
  images={[
    {
      src: compileRunSeparate,
      alt: `Terminal exibindo quatro comandos executados. O primeiro é "ls" e mostra os arquivos "functions.c" e "main.c" dentro da pasta "separate_function". O segundo é o de compilação, que não retorna nenhum texto. O terceiro é "ls" novamente, que agora mostra os arquivos "functions.c", "main.c" e "separate_function". O quarto é a execução do programa, que retorna "The sum of 5 and 7 is 12.".`,
    },
  ]}
/>

## Visual Studio Code

Para compilar e executar programas em C no Visual Studio Code, devemos instalar algumas extensões.
Recomendamos criar um perfil para o C e C++, o que manterá as configurações para essas linguagens separadas.

### Perfil

Para criar um perfil no Visual Studio Code, clique no ícone de engrenagem no canto inferior esquerdo e selecione **Profiles** (ou perfis).

<Figure
  caption={`Abrindo a tela de configuração de perfis do Visual Studio Code.`}
  images={[
    {
      src: openingProfiles,
      alt: `Menu de configuração do Visual Studio Code, em que se seleciona a opção "Profiles".`,
    },
  ]}
/>

Clique no botão **New Profile**.
Uma nova entrada surgirá na lista de perfis.

Dê um nome ao perfil, como `C/C++`.
Escolha o ícone de sua preferências.

<Figure
  caption={`Criando um novo perfil chamado "C/C++".`}
  images={[
    {
      src: createProfile,
      alt: `Tela de criação de perfil do Visual Studio Code, em que se preenche o nome "C/C++" e se escolhe um ícone.`,
    },
  ]}
/>

Agora, selecione o perfil ao clicar no ícone de check ao lado da entrada dele na lista de perfis.

<Figure
  caption={`Selecionando o perfil "C/C++".`}
  images={[
    {
      src: selectProfile,
      alt: `Menu de perfis do Visual Studio Code, em que se seleciona o perfil "C/C++".`,
    },
  ]}
/>

### Extensões

Tendo ativado o perfil `C/C++`, instale as seguinte extensões no Visual Studio Code:

- [Git Graph](https://marketplace.visualstudio.com/items?itemName=mhutchie.git-graph): visualiza o histórico de commits do Git;
- [C/C++](https://marketplace.visualstudio.com/items?itemName=ms-vscode.cpptools): fornece suporte para desenvolvimento em C e C++;
- [clangd](https://marketplace.visualstudio.com/items?itemName=llvm-vs-code-extensions.vscode-clangd): fornece recursos de análise de código para o Clang;
- [CodeLLDB](https://marketplace.visualstudio.com/items?itemName=vadimcn.vscode-lldb): permite a depuração de programas em C e C++.

Se você estiver usando o WSL, certifique-se de clicar nos botões **Install in WSL: Ubuntu** para cada extensão da lista de instaladas que oferecer essa opção.

### Configurações

Vamos adicionar algumas configurações padrão para o perfil `C/C++`.

Abra a paleta de comandos do Visual Studio Code com <Keyboard keys={["Ctrl", "Shift", "P"]} /> e pesquise por `Preferences: Open User
Settings (JSON)`, ou o equivalente em português.

Isso abrirá um arquivo chamado `settings.json`, responsável por definir as configurações desse perfil.
Toda vez que você muda alguma opção no menu de configurações do Visual Studio Code, o que ele faz é adicionar ou modificar uma linha nesse arquivo por baixo dos panos.

Copie o conteúdo a seguir e cole no arquivo `settings.json` aberto.

```json
{
  "C_Cpp.default.cStandard": "c23",
  "C_Cpp.default.cppStandard": "c++23",
  "C_Cpp.default.includePath": ["${workspaceFolder}/**"],
  "C_Cpp.default.intelliSenseMode": "clang-x64",
  "C_Cpp.intelliSenseEngine": "disabled",
  "[css]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode"
  },
  "[html]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode"
  },
  "[javascript]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode"
  },
  "[json]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode",
    "editor.tabSize": 2
  },
  "[jsonc]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode",
    "editor.tabSize": 2
  },
  "[markdown]": {
    "editor.defaultFormatter": "DavidAnson.vscode-markdownlint",
    "editor.formatOnPaste": true,
    "editor.formatOnSave": true,
    "editor.tabSize": 2,
    "prettier.tabWidth": 2
  },
  "editor.formatOnSave": true,
  "editor.inlineSuggest.enabled": true,
  "editor.semanticHighlighting.enabled": true,
  "files.eol": "\n",
  "files.insertFinalNewline": true,
  "files.trimFinalNewlines": true,
  "git.autofetch": true,
  "git.openRepositoryInParentFolders": "always",
  "security.allowedUNCHosts": ["wsl$", "wsl.localhost"]
}
```

Perceba que, abrindo o arquivo `settings.json` quando se usa o perfil `C/C++`, você verá as configurações específicas para este perfil, e não as configurações gerais do Visual Studio Code.
É este mesmo o objetivo que temos.

A configuração definida no arquivo `settings.json` faz o seguinte:

- O compilador Clang é definido como o compilador padrão;
- Ativamos o IntelliSense para o Clang;
- As versões do C e do C++ são definidas como C23 e C++23, respectivamente;
- Definimos o formatador padrão como a extensão `clangd`, e desativamos a formatação da extensão `C/C++`;
- Entre outras definições úteis.

Salve o arquivo e feche o Visual Studio Code.

<Aside type="tip">
  Caso você venha a precisar compilar um projeto para uma versão mais velha que
  a 23, basta alterar o valor das chaves `C_Cpp.default.cStandard` e
  `C_Cpp.default.cppStandard` para a versão desejada.
</Aside>
